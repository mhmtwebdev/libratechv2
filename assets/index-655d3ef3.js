import{r as e,a as t,S as s,L as a,X as n,M as r,b as i,c as o,A as c,B as d,U as l,d as u,R as m}from"./ui-vendors-d35e5635.js";import{i as p,g as h,a as y,G as f,b as g,q as b,w as x,c as w,d as k,e as v,u as j,f as _,s as A,h as E,j as S,k as N,o as L,l as I,m as O,n as R}from"./firebase-lib-1a6647fc.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var D={exports:{}},B={},P=e,T=Symbol.for("react.element"),z=Symbol.for("react.fragment"),V=Object.prototype.hasOwnProperty,C=P.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H={key:!0,ref:!0,__self:!0,__source:!0};function U(e,t,s){var a,n={},r=null,i=null;for(a in void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(i=t.ref),t)V.call(t,a)&&!H.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:T,type:e,key:r,ref:i,props:n,_owner:C.current}}B.Fragment=z,B.jsx=U,B.jsxs=U,D.exports=B;var K=D.exports,$={},M=t;$.createRoot=M.createRoot,$.hydrateRoot=M.hydrateRoot;const q={},W=function(e,t,s){if(!t||0===t.length)return e();const a=document.getElementsByTagName("link");return Promise.all(t.map(e=>{if((e=function(e){return"/libratechv2/"+e}(e))in q)return;q[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(!!s)for(let s=a.length-1;s>=0;s--){const n=a[s];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})},F=({children:t,currentPage:m,onNavigate:p,onLogout:h,user:y})=>{const[f,g]=e.useState(!1),b=[...[{id:"dashboard",label:"Panel",icon:o},{id:"circulation",label:"Ödünç İşlemleri",icon:c},{id:"books",label:"Kitap Envanteri",icon:d},{id:"students",label:"Öğrenciler",icon:l},{id:"reports",label:"Raporlar",icon:u}],..."ADMIN"===y.role?[{id:"admin",label:"Admin Paneli",icon:s}]:[]];return K.jsxs("div",{className:"flex h-screen bg-gray-50 overflow-hidden flex-col md:flex-row",children:[K.jsxs("div",{className:"md:hidden bg-slate-900 text-white p-4 flex justify-between items-center shadow-md z-20 no-print",children:[K.jsxs("div",{className:"flex items-center space-x-2",children:[K.jsx(a,{size:24,className:"text-cyan-500"}),K.jsx("span",{className:"font-bold text-lg tracking-tight",children:"LibraTech"})]}),K.jsx("button",{onClick:()=>g(!f),className:"p-1 hover:bg-slate-800 rounded focus:outline-none",children:f?K.jsx(n,{size:24}):K.jsx(r,{size:24})})]}),f&&K.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden transition-opacity",onClick:()=>g(!1)}),K.jsxs("div",{className:`\n        fixed md:static inset-y-0 left-0 z-40 w-64 bg-slate-900 text-white flex flex-col shadow-xl \n        transform transition-transform duration-300 ease-in-out md:translate-x-0 no-print\n        ${f?"translate-x-0":"-translate-x-full"}\n      `,children:[K.jsxs("div",{className:"hidden md:flex p-6 items-center space-x-3 border-b border-slate-800",children:[K.jsx("div",{className:"bg-cyan-600 p-2 rounded-lg",children:K.jsx(a,{size:24})}),K.jsxs("div",{children:[K.jsx("h1",{className:"font-bold text-lg tracking-tight uppercase",children:"LibraTech"}),K.jsx("p",{className:"text-xs text-cyan-400 font-medium",children:"Okul Kütüphanesi"})]})]}),K.jsxs("div",{className:"md:hidden p-4 border-b border-slate-800 flex items-center justify-between bg-slate-950",children:[K.jsx("span",{className:"font-bold text-xs uppercase tracking-widest text-slate-500",children:"Menü Navigation"}),K.jsx("button",{onClick:()=>g(!1),children:K.jsx(n,{size:20,className:"text-slate-400"})})]}),K.jsx("nav",{className:"flex-1 p-4 space-y-2",children:b.map(e=>{const t=e.icon,s=m===e.id;return K.jsxs("button",{onClick:()=>{return t=e.id,p(t),void g(!1);var t},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-200 "+(s?"bg-cyan-600 text-white shadow-lg shadow-cyan-600/20":"text-slate-400 hover:bg-slate-800 hover:text-white"),children:[K.jsx(t,{size:20,className:s?"text-white":"text-slate-500"}),K.jsx("span",{className:"font-bold text-sm tracking-wide",children:e.label})]},e.id)})}),K.jsxs("div",{className:"p-4 border-t border-slate-800 space-y-2",children:[K.jsxs("div",{className:"flex items-center space-x-3 px-4 py-3 mb-2 bg-slate-800/50 rounded-xl",children:[K.jsx("img",{src:`https://ui-avatars.com/api/?name=${y.name}&background=0891b2&color=fff`,alt:"Profile",className:"w-10 h-10 rounded-full border-2 border-slate-700"}),K.jsxs("div",{className:"flex-1 min-w-0",children:[K.jsx("p",{className:"text-sm font-bold truncate text-white",children:y.name}),K.jsx("p",{className:"text-[10px] text-cyan-500 font-bold truncate uppercase tracking-tighter",children:y.email})]})]}),K.jsxs("button",{onClick:h,className:"w-full flex items-center space-x-3 px-4 py-2 text-rose-400 hover:bg-rose-500/10 hover:text-rose-300 rounded-lg transition-colors",children:[K.jsx(i,{size:16}),K.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Çıkış Yap"})]})]})]}),K.jsx("main",{className:"flex-1 overflow-auto w-full relative bg-gray-50",children:K.jsx("div",{className:"max-w-7xl mx-auto p-4 md:p-8 pb-20 md:pb-8",children:t})})]})};var Y=(e=>(e.AVAILABLE="AVAILABLE",e.BORROWED="BORROWED",e.LOST="LOST",e))(Y||{});const G="mahmutissiz@gmail.com",Q=p({apiKey:"AIzaSyABqzz-0liy7ouqh90O53YvB6bP4o4DuJI",authDomain:"libratechv2.firebaseapp.com",projectId:"libratechv2",storageBucket:"libratechv2.firebasestorage.app",messagingSenderId:"729755713200",appId:"1:729755713200:web:a7eec17be1fb7928718575"}),J=h(Q),X=y(Q),Z=new f;Z.setCustomParameters({prompt:"select_account"});const ee=e=>{var t;const s=e||(null==(t=X.currentUser)?void 0:t.uid);if(!s)throw new Error("Kullanıcı oturumu veya öğretmen kimliği bulunamadı.");return{books:N(J,"users",s,"books"),students:N(J,"users",s,"students"),transactions:N(J,"users",s,"transactions"),settings:v(J,"users",s,"settings","global"),profile:v(J,"users",s)}},te=e=>({id:e.id,...e.data()}),se={getBooks:async e=>{try{const t=ee(e);return(await g(t.books)).docs.map(e=>te(e))}catch(t){return[]}},addBook:async e=>{try{const t=ee(),s=b(t.books,x("isbn","==",e.isbn));if(!(await g(s)).empty)return{success:!1,message:"Bu ISBN numarasına sahip bir kitap zaten envanterinizde var."};const a={...e,status:Y.AVAILABLE,addedDate:(new Date).toISOString()};return await w(t.books,a),{success:!0,message:"Kitap başarıyla eklendi."}}catch(t){return{success:!1,message:"Hata: "+t.message}}},deleteBook:async e=>{const t=ee();await k(v(J,t.books.path,e))},getStudents:async e=>{try{const t=ee(e);return(await g(t.students)).docs.map(e=>te(e))}catch(t){return[]}},addStudent:async e=>{try{const t=ee(),s=b(t.students,x("studentNumber","==",e.studentNumber));if(!(await g(s)).empty)return{success:!1,message:"Bu numaraya sahip bir öğrenci zaten kayıtlı."};const a={...e,readingHistory:[]};return await w(t.students,a),{success:!0,message:"Öğrenci başarıyla eklendi."}}catch(t){return{success:!1,message:"Hata: "+t.message}}},deleteStudent:async e=>{const t=ee();await k(v(J,t.students.path,e))},getActiveTransactions:async e=>{try{const t=ee(e),s=await g(t.transactions),a=s.docs.map(e=>te(e)).filter(e=>!e.isReturned);if(0===a.length)return[];const[n,r]=await Promise.all([se.getBooks(e),se.getStudents(e)]);return a.map(e=>{const t=n.find(t=>t.id===e.bookId),s=r.find(t=>t.id===e.studentId);return t&&s?{...e,book:t,student:s}:null}).filter(e=>null!==e)}catch(t){return[]}},getAllTransactions:async e=>{try{const t=ee(e),s=(await g(t.transactions)).docs.map(e=>te(e)),[a,n]=await Promise.all([se.getBooks(e),se.getStudents(e)]);return s.map(e=>{const t=a.find(t=>t.id===e.bookId),s=n.find(t=>t.id===e.studentId);return t&&s?{...e,book:t,student:s}:null}).filter(e=>null!==e)}catch(t){return[]}},issueBook:async(e,t,s)=>{try{const a=ee(),n=b(a.books,x("isbn","==",e)),r=await g(n);if(r.empty)return{success:!1,message:"Envanterinizde bu ISBN/QR kodu ile kitap bulunamadı."};const i=r.docs[0],o=te(i),c=b(a.students,x("studentNumber","==",t)),d=await g(c);if(d.empty)return{success:!1,message:"Bu numara/QR ile kayıtlı öğrenci bulunamadı."};const l=d.docs[0],u=te(l);if(o.status!==Y.AVAILABLE)return{success:!1,message:"Kitap şu anda başkasında ödünçte."};let m;u.readingHistory&&u.readingHistory.includes(o.id)&&(m=`Dikkat! ${u.name} isimli öğrenci "${o.title}" kitabını daha önce okumuş.`);const p={bookId:o.id,studentId:u.id,issueDate:(new Date).toISOString(),dueDate:new Date(Date.now()+24*s*60*60*1e3).toISOString(),isReturned:!1};await w(a.transactions,p),await j(v(J,a.books.path,o.id),{status:Y.BORROWED});const h=u.readingHistory||[];return await j(v(J,a.students.path,u.id),{readingHistory:[...h,o.id]}),{success:!0,message:"Kitap başarıyla ödünç verildi.",warning:m}}catch(a){return{success:!1,message:"İşlem Başarısız: "+a.message}}},returnBook:async e=>{try{const t=ee(),s=b(t.books,x("isbn","==",e)),a=await g(s);if(a.empty)return{success:!1,message:"Kitap bulunamadı."};const n=a.docs[0],r=te(n),i=b(t.transactions,x("bookId","==",r.id),x("isReturned","==",!1)),o=await g(i);if(o.empty)return{success:!1,message:"Bu kitap şu anda ödünçte görünmüyor."};const c=o.docs[0];return await j(v(J,t.transactions.path,c.id),{isReturned:!0,returnDate:(new Date).toISOString()}),await j(v(J,t.books.path,r.id),{status:Y.AVAILABLE}),{success:!0,message:"Kitap envantere başarıyla iade edildi."}}catch(t){return{success:!1,message:"İade Başarısız: "+t.message}}},removeBookFromHistory:async(e,t)=>{try{const s=ee(),a=v(J,s.students.path,e),n=await _(a);if(!n.exists())return{success:!1,message:"Öğrenci bulunamadı."};const r=(n.data().readingHistory||[]).filter(e=>e!==t);return await j(a,{readingHistory:r}),{success:!0,message:"Kitap geçmişten silindi."}}catch(s){return{success:!1,message:"Hata: "+s.message}}},checkBookForStudent:async(e,t)=>{try{const s=ee(),a=b(s.books,x("isbn","==",e)),n=await g(a);if(n.empty)return{success:!1,message:"Kitap bulunamadı.",type:"NOT_FOUND"};const r=te(n.docs[0]);if(r.status!==Y.AVAILABLE)return{success:!1,message:"Kitap şu anda ödünçte.",type:"NOT_AVAILABLE"};if(t){const e=b(s.students,x("studentNumber","==",t)),a=await g(e);if(!a.empty){const e=te(a.docs[0]);if(e.readingHistory&&e.readingHistory.includes(r.id))return{success:!1,message:"Bu öğrenci bu kitabı daha önce okumuş!",type:"ALREADY_READ"}}}return{success:!0,message:"Uygun",type:"VALID"}}catch(s){return{success:!1,message:"Hata oluştu.",type:"NOT_FOUND"}}},getSettings:async e=>{try{const t=ee(e),s=await _(t.settings);return s.exists()?s.data():{parentViewPrivate:!0}}catch(t){return{parentViewPrivate:!0}}},updateSettings:async e=>{try{const t=ee();return await A(t.settings,e),!0}catch(t){return!1}},getUserRole:async e=>{var t;try{if((null==(t=X.currentUser)?void 0:t.email)===G)return"ADMIN";const s=await _(v(J,"users",e));return s.exists()&&s.data().role||"TEACHER"}catch{return"TEACHER"}},syncUserProfile:async(e,t)=>{try{const s=v(J,"users",e),a=await _(s),n=t.email===G?"ADMIN":"TEACHER";a.exists()?a.data().role!==n&&await j(s,{role:n}):await A(s,{...t,role:n,createdAt:(new Date).toISOString()})}catch(s){}},getGlobalStats:async()=>{try{const[e,t,s,a]=await Promise.all([E(S(J,"books")),E(S(J,"students")),E(S(J,"transactions")),E(N(J,"users"))]);return{totalBooks:e.data().count,totalStudents:t.data().count,totalTransactions:s.data().count,totalTeachers:a.data().count}}catch(e){return{totalBooks:0,totalStudents:0,totalTransactions:0,totalTeachers:0}}},getTeachers:async()=>{try{return(await g(N(J,"users"))).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return[]}},addLog:async e=>{try{await w(N(J,"system_logs"),{...e,timestamp:(new Date).toISOString()})}catch(t){}},getSystemLogs:async()=>{try{const e=b(N(J,"system_logs"),L("timestamp","desc"),I(50));return(await g(e)).docs.map(e=>te(e))}catch(e){return[]}},getSupportRequests:async()=>{try{const e=b(N(J,"support_requests"),L("createdAt","desc"));return(await g(e)).docs.map(e=>te(e))}catch(e){return[]}},getSystemPerformance:async()=>{const e=performance.now();try{await g(b(N(J,"users"),I(1)));const t=Math.round(performance.now()-e);let s="EXCELLENT";return t>500?s="SLOW":t>200&&(s="GOOD"),{latency:t,status:s}}catch{return{latency:0,status:"SLOW"}}},addAnnouncement:async e=>{var t;try{return await w(N(J,"announcements"),{...e,authorEmail:null==(t=X.currentUser)?void 0:t.email,createdAt:(new Date).toISOString(),isActive:!0}),!0}catch(s){return!1}},getAnnouncements:async(e=!0)=>{try{let t;t=e?b(N(J,"announcements"),x("isActive","==",!0),L("createdAt","desc")):b(N(J,"announcements"),L("createdAt","desc"));return(await g(t)).docs.map(e=>te(e))}catch(t){return[]}},updateAnnouncementStatus:async(e,t)=>{try{return await j(v(J,"announcements",e),{isActive:t}),!0}catch(s){return!1}},deleteAnnouncement:async e=>{try{return await k(v(J,"announcements",e)),!0}catch(t){return!1}}},ae=e.lazy(()=>W(()=>import("./Login-2c536621.js"),["assets/Login-2c536621.js","assets/ui-vendors-d35e5635.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.Login}))),ne=e.lazy(()=>W(()=>import("./Dashboard-a201aaca.js"),["assets/Dashboard-a201aaca.js","assets/ui-vendors-d35e5635.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.Dashboard}))),re=e.lazy(()=>W(()=>import("./Circulation-59672790.js"),["assets/Circulation-59672790.js","assets/ui-vendors-d35e5635.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.Circulation}))),ie=e.lazy(()=>W(()=>import("./BookInventory-85e8f8ea.js"),["assets/BookInventory-85e8f8ea.js","assets/ui-vendors-d35e5635.js","assets/QRCodeDisplay-d70a0d15.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.BookInventory}))),oe=e.lazy(()=>W(()=>import("./Students-0a48b5f5.js"),["assets/Students-0a48b5f5.js","assets/ui-vendors-d35e5635.js","assets/QRCodeDisplay-d70a0d15.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.Students}))),ce=e.lazy(()=>W(()=>import("./Reports-75886fe1.js"),["assets/Reports-75886fe1.js","assets/ui-vendors-d35e5635.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.Reports}))),de=e.lazy(()=>W(()=>import("./ParentView-f2b58020.js"),["assets/ParentView-f2b58020.js","assets/ui-vendors-d35e5635.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.ParentView}))),le=e.lazy(()=>W(()=>import("./AdminDashboard-4ee40b2d.js"),["assets/AdminDashboard-4ee40b2d.js","assets/ui-vendors-d35e5635.js","assets/firebase-lib-1a6647fc.js"]).then(e=>({default:e.AdminDashboard}))),ue=()=>{const[t,s]=e.useState(null),[a,n]=e.useState("dashboard"),[r,i]=e.useState(!0),o=new URLSearchParams(window.location.search||window.location.hash.split("?")[1]),c="parent"===o.get("view");e.useEffect(()=>{const e=O(X,e=>{e?se.getUserRole(e.uid).then(t=>{s({id:e.uid,role:t,email:e.email||"",name:e.displayName||"Öğretmen"}),i(!1)}):(s(null),i(!1))});return()=>e()},[]);const d=()=>{};if(c){const t=o.get("teacher");return K.jsx(e.Suspense,{fallback:K.jsx(me,{}),children:K.jsx(de,{teacherId:t})})}if(r)return K.jsx(me,{});if(!t)return K.jsx(e.Suspense,{fallback:K.jsx(me,{}),children:K.jsx(ae,{onLogin:d})});return K.jsx(F,{currentPage:a,onNavigate:n,onLogout:async()=>{try{await R(X),s(null),n("dashboard")}catch(e){}},user:t,children:K.jsx(e.Suspense,{fallback:K.jsx(me,{}),children:(()=>{switch(a){case"dashboard":default:return K.jsx(ne,{});case"circulation":return K.jsx(re,{});case"books":return K.jsx(ie,{});case"students":return K.jsx(oe,{});case"reports":return K.jsx(ce,{});case"admin":return K.jsx(le,{})}})()})})},me=()=>K.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:K.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"})}),pe=document.getElementById("root");if(!pe)throw new Error("Could not find root element to mount to");$.createRoot(pe).render(K.jsx(m.StrictMode,{children:K.jsx(ue,{})}));export{Y as B,se as L,W as _,X as a,Z as g,K as j};
