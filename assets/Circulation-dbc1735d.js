import{c as N,j as e,X as K,b as A}from"./index-10d1ebfd.js";import{r as l,W as L}from"./vendor-e917c440.js";import{U as R}from"./user-1744533d.js";import{B as D}from"./book-e997e83a.js";import{C as I,Z as U}from"./zap-52d9ed96.js";import{A as H}from"./alert-circle-b5ba0eab.js";import{A as F}from"./alert-triangle-9ab2a320.js";const G=N("BookDown",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"m9 10 3 3 3-3",key:"zt5b4y"}]]),V=N("BookUp",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"m9 10 3-3 3 3",key:"11gsxs"}]]),q=N("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),O=N("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),P=N("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Q=({onComplete:x,onCancel:w,isReturnOnly:i=!1})=>{const[o,d]=l.useState(i?"SCAN_BOOKS_ONLY":"SCAN_STUDENT"),[n,m]=l.useState(null),[r,v]=l.useState([]),[g,S]=l.useState(null),[s,b]=l.useState(null),[j,p]=l.useState(!1),u=l.useRef(null),f=l.useRef(0),C=l.useRef(!1),T=(t="success")=>{try{const c=new(window.AudioContext||window.webkitAudioContext),a=c.createOscillator(),h=c.createGain();a.connect(h),h.connect(c.destination),a.type="sine",a.frequency.setValueAtTime(t==="success"?880:220,c.currentTime),h.gain.setValueAtTime(.1,c.currentTime),a.start(),setTimeout(()=>{a.stop(),c.close()},t==="success"?150:400)}catch(c){console.error("Audio play failed",c)}};l.useEffect(()=>{const t="optimized-reader";return(async()=>{try{const a=new L(t);u.current=a,await a.start({facingMode:"environment"},{fps:20,qrbox:(h,k)=>{const y=Math.min(h,k),B=Math.floor(y*.7);return{width:B,height:B}},aspectRatio:1,disableFlip:!1},(h,k)=>{E(h)},h=>{}),C.current=!0}catch(a){console.error("Error starting scanner",a)}})(),()=>{u.current&&C.current&&(u.current.stop().then(()=>{var a;(a=u.current)==null||a.clear()}).catch(a=>{console.error("Failed to stop scanner",a)}),C.current=!1)}},[]);const $=l.useRef({scanState:o,studentId:n,books:r});l.useEffect(()=>{$.current={scanState:o,studentId:n,books:r}},[o,n,r]);const E=async t=>{const c=Date.now();if(c-f.current<1e3)return;f.current=c;const{scanState:a,studentId:h,books:k}=$.current;if(a==="SCAN_STUDENT")T("success"),m(t),d("SCAN_BOOKS"),z(t,"success","Öğrenci Tanımlandı");else{if(k.includes(t))return;if(!i){const y=await A.checkBookForStudent(t,h);if(!y.success){T("error"),z(t,"error",y.message);return}}T("success"),v(y=>[...y,t]),z(t,"success",i?"İade Listesine Eklendi":"Ödünç Listesine Eklendi")}},z=(t,c,a)=>{S(t),b({type:c,message:a}),p(!0),setTimeout(()=>p(!1),c==="success"?1e3:2e3)},M=()=>{const t=prompt("Öğrenci Numarası Girin:");t&&E(t)},_=()=>{const t=prompt("Kitap Barkodu Girin:");t&&E(t)};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col items-center justify-between p-4",children:[e.jsxs("div",{className:"w-full text-white flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[o==="SCAN_STUDENT"?e.jsx(R,{className:"text-cyan-400"}):e.jsx(D,{className:"text-emerald-400"}),o==="SCAN_STUDENT"?"Öğrenci Kartını Okutun":i?"İade Edilecek Kitapları Okutun":"Kitapları Okutun"]}),e.jsx("button",{onClick:w,className:"p-2 bg-slate-800 rounded-full hover:bg-slate-700",children:e.jsx(K,{size:24})})]}),e.jsxs("div",{className:"relative w-full flex-grow flex items-center justify-center bg-black overflow-hidden rounded-3xl border-2 border-slate-700",children:[e.jsx("div",{id:"optimized-reader",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:e.jsxs("div",{className:`w-64 h-64 md:w-80 md:h-80 border-4 rounded-3xl opacity-60 ${o==="SCAN_STUDENT"?"border-cyan-400":"border-emerald-400"}`,children:[e.jsx("div",{className:`absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 -mt-1 -ml-1 rounded-tl-xl ${o==="SCAN_STUDENT"?"border-cyan-400":"border-emerald-400"}`}),e.jsx("div",{className:`absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 -mt-1 -mr-1 rounded-tr-xl ${o==="SCAN_STUDENT"?"border-cyan-400":"border-emerald-400"}`}),e.jsx("div",{className:`absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 -mb-1 -ml-1 rounded-bl-xl ${o==="SCAN_STUDENT"?"border-cyan-400":"border-emerald-400"}`}),e.jsx("div",{className:`absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 -mb-1 -mr-1 rounded-br-xl ${o==="SCAN_STUDENT"?"border-cyan-400":"border-emerald-400"}`})]})}),j&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-black/70 animated-fade-in backdrop-blur-sm",children:e.jsxs("div",{className:`text-black p-8 rounded-[2rem] flex flex-col items-center animate-bounce-in shadow-2xl ${(s==null?void 0:s.type)==="success"?"bg-white":"bg-rose-50 border-4 border-rose-500"}`,children:[(s==null?void 0:s.type)==="success"?e.jsx(I,{size:64,className:"text-emerald-500 mb-4"}):e.jsx(H,{size:64,className:"text-rose-500 mb-4 animate-pulse"}),e.jsx("p",{className:"text-2xl font-black mb-1",children:g}),e.jsx("p",{className:`text-lg font-bold ${(s==null?void 0:s.type)==="success"?"text-slate-500":"text-rose-600"}`,children:s==null?void 0:s.message})]})})]}),e.jsxs("div",{className:"w-full mt-6 space-y-4",children:[e.jsxs("div",{className:"bg-slate-900 border border-slate-700 text-white p-5 rounded-2xl flex items-center justify-between shadow-lg",children:[!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${n?"bg-cyan-600":"bg-slate-800"}`,children:e.jsx(R,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-wider",children:"Aktif Öğrenci"}),e.jsx("p",{className:"font-mono font-bold text-lg",children:n||"Bekleniyor..."})]})]}),e.jsx("div",{className:"h-10 w-px bg-slate-700"})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-grow justify-center",children:[e.jsx("div",{className:`p-3 rounded-xl ${r.length>0?"bg-emerald-600":"bg-slate-800"}`,children:e.jsx(D,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-wider",children:i?"Toplanacak Kitap":"Kitap Sayısı"}),e.jsx("p",{className:"font-mono font-bold text-lg text-center",children:r.length})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o==="SCAN_BOOKS"&&e.jsxs("button",{onClick:()=>{d("SCAN_STUDENT"),m(null),v([])},className:"flex items-center justify-center gap-2 py-4 px-4 bg-slate-800 text-white rounded-2xl font-bold uppercase tracking-wide hover:bg-slate-700 active:scale-95 transition-transform",children:[e.jsx(O,{size:20}),e.jsx("span",{children:"Sıfırla"})]}),e.jsxs("button",{onClick:()=>(i||n)&&r.length>0?x(n,r):null,disabled:i?r.length===0:!n||r.length===0,className:`col-span-${o==="SCAN_STUDENT"||i?"2":"1"} flex items-center justify-center gap-2 py-4 px-4 rounded-2xl font-black uppercase tracking-wider text-base shadow-lg active:scale-95 transition-all ${(i||n)&&r.length>0?"bg-emerald-500 hover:bg-emerald-600 text-white shadow-emerald-500/20":"bg-slate-800 text-slate-500 cursor-not-allowed"}`,children:[e.jsx(P,{size:20}),e.jsx("span",{children:i?"İadeleri Tamamla":"Ödünç İşlemini Tamamla"})]})]}),e.jsxs("div",{className:"flex justify-center gap-6",children:[e.jsx("button",{onClick:M,className:"text-xs font-bold uppercase tracking-widest text-slate-500 hover:text-white transition-colors",children:"El ile Öğrenci Gir"}),n&&e.jsx("button",{onClick:_,className:"text-xs font-bold uppercase tracking-widest text-slate-500 hover:text-white transition-colors",children:"El ile Kitap Gir"})]})]})]})},te=()=>{const[x,w]=l.useState("ISSUE"),[i,o]=l.useState(14),[d,n]=l.useState(null),[m,r]=l.useState(null),[v,g]=l.useState(!1),S=async(s,b)=>{g(!1),r(null),n({type:"warning",msg:"İşlem yapılıyor, lütfen bekleyin..."});const j=[],p=[];for(const u of b)try{const f=x==="ISSUE"?await A.issueBook(u,s,i):await A.returnBook(u);f.success?j.push(`${u}: ${f.message}`):p.push(`${u}: ${f.message}`)}catch{p.push(`${u}: Sistem hatası`)}r({successes:j,failures:p}),p.length===0?n({type:"success",msg:`Toplam ${j.length} kitap başarıyla ${x==="ISSUE"?"ödünç verildi":"iade alındı"}.`}):n({type:"warning",msg:`${j.length} kitap başarılı, ${p.length} kitapta hata oluştu.`})};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-10 pb-24",children:[e.jsxs("div",{className:"text-center space-y-3 py-4",children:[e.jsx("h2",{className:"text-4xl font-black text-slate-900 tracking-tight uppercase",children:"Ödünç & İade Bankosu"}),e.jsx("p",{className:"text-slate-500 text-lg font-medium max-w-xl mx-auto",children:"Hızlı tarama sistemi ile kitap işlemlerini saniyeler içinde tamamlayın."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:`relative overflow-hidden group rounded-[2.5rem] p-10 border-2 transition-all cursor-pointer ${x==="ISSUE"?"border-cyan-500 bg-white shadow-2xl shadow-cyan-900/10 scale-105 z-10":"border-slate-200 bg-slate-50 hover:border-cyan-200 hover:bg-white opacity-80 hover:opacity-100"}`,onClick:()=>{w("ISSUE"),n(null),r(null)},children:[e.jsxs("div",{className:"flex flex-col h-full justify-between relative z-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`w-16 h-16 rounded-[1.2rem] flex items-center justify-center shadow-lg transition-colors ${x==="ISSUE"?"bg-cyan-500 text-white shadow-cyan-300":"bg-slate-200 text-slate-400"}`,children:e.jsx(G,{size:36})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-slate-800 uppercase tracking-tight",children:"Kitap Ver (Ödünç)"}),e.jsx("p",{className:"text-slate-500 font-medium mt-2 leading-relaxed",children:"Öğrenci kartı ve kitapları taratarak ödünç verin."})]})]}),x==="ISSUE"&&e.jsxs("div",{className:"mt-10 space-y-6 animate-soft-fade",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"issue-duration",className:"text-[10px] uppercase font-black text-slate-400 tracking-widest pl-1",children:"Ödünç Süresi"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"issue-duration",name:"issue-duration",value:i,onClick:s=>s.stopPropagation(),onChange:s=>o(Number(s.target.value)),className:"block w-full rounded-2xl border-2 border-slate-200 bg-slate-50 py-4 px-5 font-bold text-slate-700 outline-none focus:border-cyan-500 focus:bg-white transition-all appearance-none",children:[e.jsx("option",{value:7,children:"7 Gün (1 Hafta)"}),e.jsx("option",{value:14,children:"14 Gün (2 Hafta)"}),e.jsx("option",{value:30,children:"30 Gün (1 Ay)"}),e.jsx("option",{value:90,children:"90 Gün (Dönemlik)"})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),g(!0)},className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white py-5 rounded-2xl font-black text-lg uppercase tracking-widest flex items-center justify-center gap-3 shadow-xl shadow-cyan-600/30 transition-all hover:scale-[1.02] active:scale-[0.98]",children:[e.jsx(U,{size:24,fill:"currentColor"}),e.jsx("span",{children:"Hızlı Taramayı Başlat"})]})]})]}),x==="ISSUE"&&e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-cyan-100/50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 -z-10"})]}),e.jsxs("div",{className:`relative overflow-hidden group rounded-[2.5rem] p-10 border-2 transition-all cursor-pointer ${x==="RETURN"?"border-emerald-500 bg-white shadow-2xl shadow-emerald-900/10 scale-105 z-10":"border-slate-200 bg-slate-50 hover:border-emerald-200 hover:bg-white opacity-80 hover:opacity-100"}`,onClick:()=>{w("RETURN"),n(null),r(null)},children:[e.jsxs("div",{className:"flex flex-col h-full justify-between relative z-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`w-16 h-16 rounded-[1.2rem] flex items-center justify-center shadow-lg transition-colors ${x==="RETURN"?"bg-emerald-500 text-white shadow-emerald-300":"bg-slate-200 text-slate-400"}`,children:e.jsx(V,{size:36})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-slate-800 uppercase tracking-tight",children:"Kitap Al (İade)"}),e.jsx("p",{className:"text-slate-500 font-medium mt-2 leading-relaxed",children:"İade edilen kitapları topluca envantere geri alın."})]})]}),x==="RETURN"&&e.jsx("div",{className:"mt-10 animate-soft-fade",children:e.jsxs("button",{onClick:s=>{s.stopPropagation(),g(!0)},className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white py-5 rounded-2xl font-black text-lg uppercase tracking-widest flex items-center justify-center gap-3 shadow-xl shadow-emerald-600/30 transition-all hover:scale-[1.02] active:scale-[0.98]",children:[e.jsx(U,{size:24,fill:"currentColor"}),e.jsx("span",{children:"Hızlı Taramayı Başlat"})]})})]}),x==="RETURN"&&e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-100/50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 -z-10"})]})]}),v&&e.jsx(Q,{onComplete:S,onCancel:()=>g(!1),isReturnOnly:x==="RETURN"}),d&&e.jsxs("div",{className:`p-6 rounded-[2rem] flex items-center space-x-5 border-2 animate-soft-fade ${d.type==="error"?"bg-rose-50 text-rose-800 border-rose-100":d.type==="warning"?"bg-amber-50 text-amber-800 border-amber-100":"bg-emerald-50 text-emerald-800 border-emerald-100"}`,children:[e.jsxs("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${d.type==="error"?"bg-rose-200 text-rose-700":d.type==="warning"?"bg-amber-200 text-amber-700":"bg-emerald-200 text-emerald-700"}`,children:[d.type==="error"&&e.jsx(H,{size:28}),d.type==="warning"&&e.jsx(F,{size:28}),d.type==="success"&&e.jsx(I,{size:28})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-black uppercase tracking-wide mb-1 opacity-80",children:d.type==="error"?"Hata Oluştu":d.type==="warning"?"Uyarı":"İşlem Başarılı"}),e.jsx("p",{className:"font-bold text-lg",children:d.msg})]})]}),m&&e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] overflow-hidden shadow-2xl shadow-slate-200/50 animate-soft-fade",children:[e.jsxs("div",{className:"bg-slate-50/80 px-8 py-6 border-b border-slate-100 flex justify-between items-center backdrop-blur-sm",children:[e.jsxs("h3",{className:"font-black text-xl text-slate-800 flex items-center gap-3 uppercase tracking-tight",children:[e.jsx(q,{size:24,className:"text-cyan-600"}),"İşlem Raporu"]}),e.jsxs("button",{onClick:()=>r(null),className:"text-slate-400 hover:text-slate-600 transition-colors font-bold text-sm uppercase tracking-wider flex items-center gap-2",children:["Raporu Kapat ",e.jsx(U,{size:16,className:"inline rotate-12"})]})]}),e.jsxs("div",{className:"p-8 grid md:grid-cols-2 gap-8",children:[m.successes.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-black text-emerald-600 uppercase tracking-widest flex items-center gap-2 mb-2",children:["Başarılı İşlemler (",m.successes.length,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:m.successes.map((s,b)=>e.jsxs("div",{className:"p-4 bg-emerald-50 rounded-2xl text-sm text-emerald-800 font-bold flex items-center gap-3 border border-emerald-100/50",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-sm shadow-emerald-400"}),s]},b))})]}),m.failures.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-black text-rose-600 uppercase tracking-widest flex items-center gap-2 mb-2",children:["Hatalı İşlemler (",m.failures.length,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:m.failures.map((s,b)=>e.jsxs("div",{className:"p-4 bg-rose-50 rounded-2xl text-sm text-rose-800 font-bold flex items-center gap-3 border border-rose-100/50",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500 shadow-sm shadow-rose-400"}),s]},b))})]})]})]})]})};export{te as Circulation};
